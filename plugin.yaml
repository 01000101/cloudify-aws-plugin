##################################################################################
# Cloudify AWS EC2 built in types and plugins definitions.
##################################################################################

plugins:
  cloudify-aws-plugin:
    executor: central_deployment_agent
    source: https://github.com/cloudify-cosmo/cloudify-aws-plugin/archive/master.zip

node_types:
  cloudify.aws.nodes.Instance:
    derived_from: cloudify.nodes.Compute
    properties:
      attributes:
        default: {}
      ami_image_id: {}
      instance_type: {}
      use_external_resource:
        default: false
      resource_id:
        default: ''
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: cloudify-aws-plugin.ec2.instance.run
          inputs: {}
        start:
          implementation: cloudify-aws-plugin.ec2.instance.start
          inputs: {}
        stop:
          implementation: cloudify-aws-plugin.ec2.instance.stop
          inputs: {}
        delete:
          implementation: cloudify-aws-plugin.ec2.instance.terminate
          inputs: {}
      cloudify.interfaces.validation:
        creation:
          implementation: cloudify-aws-plugin.ec2.instance.creation_validation
          inputs: {}

  cloudify.aws.nodes.ElasticIP:
    derived_from: cloudify.nodes.VirtualIP
    properties:
      elasticip:
        default: {}
      use_external_resource:
        default: false
      resource_id:
        default: ''
    interfaces:
      cloudify.interfaces.lifecycle:
        create: cloudify-aws-plugin.ec2.elasticip.allocate
        delete: cloudify-aws-plugin.ec2.elasticip.release
      cloudify.interfaces.validation:
        creation:
          implementation: cloudify-aws-plugin.ec2.elasticip.creation_validation
          inputs: {}

relationships:
  cloudify.aws.relationships.instance_connected_to_elastic_ip:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish: cloudify-aws-plugin.ec2.elasticip.associate
        unlink: cloudify-aws-plugin.ec2.elasticip.disassociate
