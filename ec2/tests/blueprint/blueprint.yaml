# DSL version, should appear in the main blueprint.yaml
# and may appear in other imports. In such case, the versions must match
tosca_definitions_version: cloudify_dsl_1_0

imports:
    - http://www.getcloudify.org/spec/cloudify/3.2m1/types.yaml
    - ./test_plugin.yaml
    - ../../../plugin.yaml

inputs:

  test_security_group_name:
    default: ''

  test_security_group_desc:
    default: ''

  test_key_name:
    default: ''

  test_key_path:
    default: ''

  test_ami_image_id:
    description: an input for the test
    default: ''

  test_instance_type:
    description: an input for the test
    default: ''

node_templates:

    test_security_group:
      type: cloudify.aws.nodes.SecurityGroup
      properties:
        name: { get_input: test_security_group_name }
        description: { get_input: test_security_group_desc }
        rules:
          - ip_protocol: tcp
            from_port: 80
            to_port: 80
            cidr_ip: 0.0.0.0/32

    test_key_pair:
      type: cloudify.aws.nodes.KeyPair
      properties:
        name: { get_input: test_key_name }
        private_key_path: { get_input: test_key_path }

    test_instance:
      type: cloudify.aws.nodes.Instance
      properties:
        install_agent: false
        image_id: { get_input: test_ami_image_id }
        instance_type: { get_input: test_instance_type }
        attributes:
          key_name: { get_property: [ test_key_pair, name ] }
          security_groups: { get_property: [ test_security_group, name ] }

